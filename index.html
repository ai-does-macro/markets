<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Market Performance Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --bg-main: #05050a;
            --bg-panel: #111319;
            --bg-header: #181b23;
            --bg-table-header: #202431;
            --text-main: #f5f5f5;
            --text-muted: #9ca3af;
            --accent-pos: #22c55e;
            --accent-neg: #ef4444;
            --accent-neutral: #e5e7eb;
            --border-subtle: #1f2933;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
        }

        .page {
            min-height: 100vh;
            padding: 16px 4vw 32px;
        }

        header {
            display: flex;
            flex-wrap: wrap;
            align-items: baseline;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 16px;
        }

        header h1 {
            margin: 0;
            font-size: 20px;
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        header .subtitle {
            font-size: 13px;
            color: var(--text-muted);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .badge {
            padding: 3px 8px;
            border-radius: 999px;
            background: rgba(148, 163, 184, 0.18);
            border: 1px solid rgba(148, 163, 184, 0.4);
            font-size: 11px;
        }

        .layout-grid {
            display: grid;
            grid-template-columns: minmax(0, 1.8fr) minmax(0, 1.1fr);
            gap: 16px;
        }

        @media (max-width: 1100px) {
            .layout-grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        section.panel {
            background: radial-gradient(circle at top left, #1e293b 0, #020617 52%);
            border-radius: 14px;
            padding: 12px;
            border: 1px solid rgba(15, 23, 42, 0.9);
            box-shadow:
                0 0 0 1px rgba(15, 23, 42, 0.9),
                0 18px 40px rgba(0, 0, 0, 0.85),
                inset 0 0 0 1px rgba(148, 163, 184, 0.14);
        }

        .panel-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .panel-title {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
        }

        .panel-subtitle {
            font-size: 11px;
            color: var(--text-muted);
        }

        .refresh-area {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        button.refresh-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-radius: 999px;
            padding: 5px 12px;
            border: none;
            color: #f9fafb;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            cursor: pointer;
            display: inline-flex;
            gap: 6px;
            align-items: center;
        }

        button.refresh-btn:disabled {
            opacity: 0.55;
            cursor: default;
        }

        button.refresh-btn span.icon {
            font-size: 12px;
        }

        .timestamp {
            font-size: 11px;
            color: var(--text-muted);
        }

        .tables-scroll {
            max-height: 68vh;
            overflow: auto;
            padding-right: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 11px;
        }

        thead {
            position: sticky;
            top: 0;
            z-index: 2;
        }

        thead tr {
            background: linear-gradient(180deg, var(--bg-table-header), #0b1020);
        }

        th, td {
            padding: 6px 6px;
            text-align: right;
            border-bottom: 1px solid var(--border-subtle);
            white-space: nowrap;
        }

        th:first-child,
        td:first-child {
            text-align: left;
        }

        th {
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
        }

        tbody tr:nth-child(even) {
            background-color: rgba(15, 23, 42, 0.7);
        }

        tbody tr:nth-child(odd) {
            background-color: rgba(15, 23, 42, 0.35);
        }

        tbody tr:hover {
            background-color: rgba(55, 65, 81, 0.9);
        }

        .name-cell {
            display: flex;
            flex-direction: column;
        }

        .name-main {
            font-size: 11px;
        }

        .name-ticker {
            font-size: 10px;
            color: var(--text-muted);
        }

        .chg {
            font-variant-numeric: tabular-nums;
        }

        .chg-pos {
            color: var(--accent-pos);
        }

        .chg-neg {
            color: var(--accent-neg);
        }

        .chg-flat {
            color: var(--accent-neutral);
        }

        .loading-row td {
            text-align: center;
            font-size: 11px;
            color: var(--text-muted);
        }

        .note {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .pill-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 4px;
        }

        .pill {
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            background: rgba(15, 23, 42, 0.7);
            font-size: 10px;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
<div class="page">
    <header>
        <div>
            <h1>Markets – Multi‑Asset Performance</h1>
            <div class="subtitle">US sectors, factors, crypto & world indices – 1D / 1W / 1M / 1Y</div>
        </div>
        <div>
            <div class="meta">
                <span class="badge">Static HTML · Netlify ready</span>
                <span class="badge">Data: Alpha Vantage (free)</span>
            </div>
            <div class="meta" id="last-updated">Last updated: –</div>
        </div>
    </header>

    <div class="layout-grid">
        <!-- Left column: US sectors & factors -->
        <section class="panel">
            <div class="panel-header">
                <div>
                    <div class="panel-title">US sectors & factors</div>
                    <div class="panel-subtitle">Includes precious metals, commodities, duration bonds & style spreads</div>
                </div>
                <div class="refresh-area">
                    <button class="refresh-btn" id="refresh-btn">
                        <span class="icon">⟳</span>
                        Refresh
                    </button>
                </div>
            </div>

            <div class="pill-row">
                <div class="pill">Timeframes are rolling calendar windows</div>
                <div class="pill">All changes in % vs close</div>
            </div>

            <div class="tables-scroll">
                <h3 style="font-size:12px;margin:10px 0 4px;">US sectors & key assets</h3>
                <table id="table-sectors">
                    <thead>
                    <tr>
                        <th>Sector / Asset</th>
                        <th>1D</th>
                        <th>1W</th>
                        <th>1M</th>
                        <th>1Y</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="loading-row"><td colspan="5">Loading…</td></tr>
                    </tbody>
                </table>

                <h3 style="font-size:12px;margin:12px 0 4px;">Style & size factors</h3>
                <table id="table-factors">
                    <thead>
                    <tr>
                        <th>Factor Pair</th>
                        <th>1D</th>
                        <th>1W</th>
                        <th>1M</th>
                        <th>1Y</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="loading-row"><td colspan="5">Loading…</td></tr>
                    </tbody>
                </table>

                <div class="note">
                    Style pairs use simple ETF proxies (e.g. value vs growth, large vs small) and show the relative performance of the first leg minus the second.
                </div>
            </div>
        </section>

        <!-- Right column: Crypto & global indices -->
        <section class="panel">
            <div class="panel-header">
                <div>
                    <div class="panel-title">Crypto & world indices</div>
                    <div class="panel-subtitle">Major crypto assets and headline equity benchmarks</div>
                </div>
                <div class="refresh-area">
                    <div class="timestamp" id="status-text">Idle</div>
                </div>
            </div>

            <div class="tables-scroll">
                <h3 style="font-size:12px;margin:10px 0 4px;">Major crypto</h3>
                <table id="table-crypto">
                    <thead>
                    <tr>
                        <th>Crypto</th>
                        <th>1D</th>
                        <th>1W</th>
                        <th>1M</th>
                        <th>1Y</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="loading-row"><td colspan="5">Loading…</td></tr>
                    </tbody>
                </table>

                <h3 style="font-size:12px;margin:12px 0 4px;">Global equity indices</h3>
                <table id="table-indices">
                    <thead>
                    <tr>
                        <th>Index</th>
                        <th>1D</th>
                        <th>1W</th>
                        <th>1M</th>
                        <th>1Y</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="loading-row"><td colspan="5">Loading…</td></tr>
                    </tbody>
                </table>

                <div class="note">
                    Indices are via liquid ETF or index tickers where available (e.g. SPY, QQQ, IWM, VGK, EWJ, EWA, EEM, etc.).
                </div>
            </div>
        </section>
    </div>
</div>

<script>
// ---------------- CONFIG ----------------

const ALPHA_VANTAGE_API_KEY = "EXZESQ1H1VTP65IX";

// helper: US sector, asset, factor, crypto, indices universe
const SECTOR_ASSETS = [
    { name: "US Total Market", ticker: "VTI" },
    { name: "S&P 500", ticker: "SPY" },
    { name: "Nasdaq 100", ticker: "QQQ" },
    { name: "Technology", ticker: "XLK" },
    { name: "Financials", ticker: "XLF" },
    { name: "Healthcare", ticker: "XLV" },
    { name: "Energy", ticker: "XLE" },
    { name: "Utilities", ticker: "XLU" },
    { name: "Real Estate", ticker: "XLRE" },
    { name: "Consumer Discretionary", ticker: "XLY" },
    { name: "Consumer Staples", ticker: "XLP" },
    { name: "Industrials", ticker: "XLI" },
    { name: "Materials", ticker: "XLB" },
    { name: "Gold", ticker: "GLD" },
    { name: "Silver", ticker: "SLV" },
    { name: "Crude Oil", ticker: "USO" },
    { name: "Short Treasuries (1–3Y)", ticker: "SHY" },
    { name: "Intermediate Treasuries (7–10Y)", ticker: "IEF" },
    { name: "Long Treasuries (20+Y)", ticker: "TLT" }
];

// each factor pair is first minus second
const FACTOR_PAIRS = [
    { name: "Value – Growth (Large)", long: "IVE", short: "IVW" },
    { name: "Value – Growth (Mid)", long: "IJJ", short: "IJK" },
    { name: "Value – Growth (Small)", long: "IJS", short: "IJT" },
    { name: "Large – Mid Cap", long: "IWB", short: "IJH" },
    { name: "Large – Small Cap", long: "IWB", short: "IJR" },
    { name: "Quality – High Yield Credit", long: "QUAL", short: "HYG" }
];

const CRYPTO_LIST = [
    { name: "Bitcoin", symbol: "BTC" },
    { name: "Ethereum", symbol: "ETH" },
    { name: "Solana", symbol: "SOL" },
    { name: "Binance Coin", symbol: "BNB" },
    { name: "XRP", symbol: "XRP" }
];

const INDEX_ASSETS = [
    { name: "US – S&P 500", ticker: "SPY" },
    { name: "US – Nasdaq 100", ticker: "QQQ" },
    { name: "US – Russell 2000", ticker: "IWM" },
    { name: "US – Dow Jones 30", ticker: "DIA" },
    { name: "Europe – STOXX 600", ticker: "VGK" },
    { name: "Eurozone – EURO STOXX 50", ticker: "FEZ" },
    { name: "UK – FTSE 100", ticker: "EWU" },
    { name: "Germany – DAX", ticker: "DAX" },  // direct index
    { name: "Japan – Nikkei 225", ticker: "^N225" }, // index symbol
    { name: "Australia – ASX 200", ticker: "^AXJO" },
    { name: "EM – MSCI Emerging", ticker: "EEM" },
    { name: "Global – ACWI", ticker: "ACWI" }
];

// ---------------- UTILITIES ----------------

function formatPct(x) {
    if (x === null || isNaN(x)) return "–";
    const v = Number(x);
    const s = v.toFixed(2) + "%";
    if (v > 0) return "+" + s;
    return s;
}

function classForChange(x) {
    if (x === null || isNaN(x)) return "chg-flat";
    if (x > 0.05) return "chg-pos";
    if (x < -0.05) return "chg-neg";
    return "chg-flat";
}

// get nearest date change vs latest
function computeWindowChange(sortedDates, seriesByDate, days) {
    if (!sortedDates.length) return null;
    const latestDate = sortedDates[0];
    const latest = seriesByDate[latestDate];
    if (latest === undefined || latest === 0) return null;

    const latestTs = new Date(latestDate).getTime();
    const targetTs = latestTs - days * 24 * 60 * 60 * 1000;

    let refPrice = null;
    for (let i = sortedDates.length - 1; i >= 0; i--) {
        const d = sortedDates[i];
        const ts = new Date(d).getTime();
        if (ts <= targetTs) {
            refPrice = seriesByDate[d];
            break;
        }
    }
    if (refPrice === null || refPrice === 0) return null;
    return ((latest - refPrice) / refPrice) * 100;
}

// ---------------- ALPHA VANTAGE CALLS ----------------

async function fetchDailySeries(symbol) {
    const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&symbol=${encodeURIComponent(symbol)}&outputsize=full&apikey=${ALPHA_VANTAGE_API_KEY}`;
    const res = await fetch(url);
    const json = await res.json();
    const series = json["Time Series (Daily)"];
    if (!series) return null;

    const map = {};
    Object.keys(series).forEach(date => {
        const close = parseFloat(series[date]["4. close"]);
        if (!isNaN(close)) map[date] = close;
    });

    const dates = Object.keys(map).sort((a, b) => b.localeCompare(a)); // desc
    return { dates, series: map };
}

async function fetchCryptoDaily(symbol) {
    // digital currency daily vs USD
    const url = `https://www.alphavantage.co/query?function=DIGITAL_CURRENCY_DAILY&symbol=${symbol}&market=USD&apikey=${ALPHA_VANTAGE_API_KEY}`;
    const res = await fetch(url);
    const json = await res.json();
    const series = json["Time Series (Digital Currency Daily)"];
    if (!series) return null;

    const map = {};
    Object.keys(series).forEach(date => {
        const close = parseFloat(series[date]["4a. close (USD)"]);
        if (!isNaN(close)) map[date] = close;
    });

    const dates = Object.keys(map).sort((a, b) => b.localeCompare(a));
    return { dates, series: map };
}

// ---------------- TABLE BUILDERS ----------------

async function buildSectorTable() {
    const tbody = document.querySelector("#table-sectors tbody");
    tbody.innerHTML = "";

    for (const asset of SECTOR_ASSETS) {
        const row = document.createElement("tr");

        const tdName = document.createElement("td");
        tdName.className = "name-cell";
        tdName.innerHTML = `<span class="name-main">${asset.name}</span><span class="name-ticker">${asset.ticker}</span>`;
        row.appendChild(tdName);

        const data = await fetchDailySeries(asset.ticker).catch(() => null);
        let chg1d = null, chg1w = null, chg1m = null, chg1y = null;

        if (data && data.dates.length) {
            chg1d = computeWindowChange(data.dates, data.series, 1);
            chg1w = computeWindowChange(data.dates, data.series, 7);
            chg1m = computeWindowChange(data.dates, data.series, 30);
            chg1y = computeWindowChange(data.dates, data.series, 365);
        }

        [chg1d, chg1w, chg1m, chg1y].forEach(val => {
            const td = document.createElement("td");
            td.className = "chg " + classForChange(val);
            td.textContent = formatPct(val);
            row.appendChild(td);
        });

        tbody.appendChild(row);
    }
}

async function buildFactorTable() {
    const tbody = document.querySelector("#table-factors tbody");
    tbody.innerHTML = "";

    for (const pair of FACTOR_PAIRS) {
        const row = document.createElement("tr");
        const tdName = document.createElement("td");
        tdName.className = "name-cell";
        tdName.innerHTML = `<span class="name-main">${pair.name}</span><span class="name-ticker">${pair.long} – ${pair.short}</span>`;
        row.appendChild(tdName);

        const longData = await fetchDailySeries(pair.long).catch(() => null);
        const shortData = await fetchDailySeries(pair.short).catch(() => null);

        function spread(days) {
            if (!longData || !shortData || !longData.dates.length || !shortData.dates.length) {
                return null;
            }
            const l = computeWindowChange(longData.dates, longData.series, days);
            const s = computeWindowChange(shortData.dates, shortData.series, days);
            if (l === null || s === null) return null;
            return l - s;
        }

        const chg1d = spread(1);
        const chg1w = spread(7);
        const chg1m = spread(30);
        const chg1y = spread(365);

        [chg1d, chg1w, chg1m, chg1y].forEach(val => {
            const td = document.createElement("td");
            td.className = "chg " + classForChange(val);
            td.textContent = formatPct(val);
            row.appendChild(td);
        });

        tbody.appendChild(row);
    }
}

async function buildCryptoTable() {
    const tbody = document.querySelector("#table-crypto tbody");
    tbody.innerHTML = "";

    for (const c of CRYPTO_LIST) {
        const row = document.createElement("tr");
        const tdName = document.createElement("td");
        tdName.className = "name-cell";
        tdName.innerHTML = `<span class="name-main">${c.name}</span><span class="name-ticker">${c.symbol}/USD</span>`;
        row.appendChild(tdName);

        const data = await fetchCryptoDaily(c.symbol).catch(() => null);

        let chg1d = null, chg1w = null, chg1m = null, chg1y = null;
        if (data && data.dates.length) {
            chg1d = computeWindowChange(data.dates, data.series, 1);
            chg1w = computeWindowChange(data.dates, data.series, 7);
            chg1m = computeWindowChange(data.dates, data.series, 30);
            chg1y = computeWindowChange(data.dates, data.series, 365);
        }

        [chg1d, chg1w, chg1m, chg1y].forEach(val => {
            const td = document.createElement("td");
            td.className = "chg " + classForChange(val);
            td.textContent = formatPct(val);
            row.appendChild(td);
        });

        tbody.appendChild(row);
    }
}

async function buildIndexTable() {
    const tbody = document.querySelector("#table-indices tbody");
    tbody.innerHTML = "";

    for (const idx of INDEX_ASSETS) {
        const row = document.createElement("tr");
        const tdName = document.createElement("td");
        tdName.className = "name-cell";
        tdName.innerHTML = `<span class="name-main">${idx.name}</span><span class="name-ticker">${idx.ticker}</span>`;
        row.appendChild(tdName);

        const data = await fetchDailySeries(idx.ticker).catch(() => null);
        let chg1d = null, chg1w = null, chg1m = null, chg1y = null;

        if (data && data.dates.length) {
            chg1d = computeWindowChange(data.dates, data.series, 1);
            chg1w = computeWindowChange(data.dates, data.series, 7);
            chg1m = computeWindowChange(data.dates, data.series, 30);
            chg1y = computeWindowChange(data.dates, data.series, 365);
        }

        [chg1d, chg1w, chg1m, chg1y].forEach(val => {
            const td = document.createElement("td");
            td.className = "chg " + classForChange(val);
            td.textContent = formatPct(val);
            row.appendChild(td);
        });

        tbody.appendChild(row);
    }
}

// ---------------- ORCHESTRATION ----------------

async function refreshAll() {
    const status = document.getElementById("status-text");
    const btn = document.getElementById("refresh-btn");
    const lastUpdated = document.getElementById("last-updated");

    btn.disabled = true;
    status.textContent = "Fetching (API limited)…";

    try {
        await buildSectorTable();
        await buildFactorTable();
        await buildCryptoTable();
        await buildIndexTable();

        const now = new Date();
        lastUpdated.textContent = "Last updated: " + now.toLocaleString();
        status.textContent = "OK";
    } catch (e) {
        console.error(e);
        status.textContent = "Error – hover console";
    } finally {
        btn.disabled = false;
    }
}

document.getElementById("refresh-btn").addEventListener("click", () => {
    refreshAll();
});

window.addEventListener("load", () => {
    refreshAll();
});
</script>
</body>
</html>
